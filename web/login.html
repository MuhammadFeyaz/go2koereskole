<!doctype html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>go2kÃ¸reskole â€“ Login</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <!-- NAV -->
  <header class="nav">
    <div class="container nav__inner">

      <div class="nav__toprow">
        <a class="brand" href="index.html">
          <span class="brand__dot"></span> go2kÃ¸reskole
        </a>

        <button class="nav__toggle" id="navToggle" type="button" aria-expanded="false" aria-controls="navMenu">
          â˜° <span data-i18n="navMenu">Menu</span>
        </button>
      </div>

      <nav class="menu" id="navMenu">
        <a data-i18n="navHome" href="index.html">Hjem</a>
        <a data-i18n="navBooking" href="booking.html">Booking</a>
        <a data-i18n="navPrices" href="priser.html">Priser</a>
        <a data-i18n="navContact" href="kontakt.html">Kontakt</a>
      </nav>

      <div class="nav__right">
        <a class="btn btn--primary" data-i18n="navBookNow" href="booking.html">Book nu</a>

        <button class="theme-toggle" id="themeToggle" type="button">
          <span id="themeIcon">ðŸŒ™</span>
          <span id="themeText" data-i18n="themeDark">MÃ¸rk</span>
        </button>

        <button class="lang-toggle" id="langToggle" type="button">
          <span id="langText">DA</span>
        </button>

        <div id="navUser" style="display:flex; gap:12px; align-items:center;">
          <span id="navUserText" class="muted"></span>
          <a id="navLoginBtn" class="btn" data-i18n="navLogin" href="login.html">Login</a>
          <button id="navLogoutBtn" class="btn" data-i18n="navLogout" style="display:none;">Log ud</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="section" style="min-height: calc(100vh - 160px); display:flex; align-items:center;">
      <div class="container" style="display:flex; justify-content:center;">
        <div class="card" style="width:min(520px, 100%);">
          <h2 style="margin:0 0 6px;">Login</h2>
          <p class="muted" style="margin:0 0 18px;" data-i18n="loginIntro">
            Log ind for at fÃ¥ adgang til booking og admin.
          </p>

          <form id="loginForm">
            <label class="field">
              <span data-i18n="loginEmail">E-mail</span>
              <input id="loginEmail" type="email" autocomplete="email" required placeholder="navn@email.com">
            </label>

            <label class="field">
              <span data-i18n="loginPassword">Kodeord</span>
              <input id="loginPassword" type="password" autocomplete="current-password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </label>

            <button class="btn btn--primary btn--full" type="submit" data-i18n="loginBtn">
              Log ind
            </button>

            <div id="loginStatus" class="status" aria-live="polite" style="margin-top:12px;"></div>

            <p class="small" style="margin-top:12px;" data-i18n="loginHint">
              Hvis du ikke har en bruger, skal admin oprette dig fÃ¸rst.
            </p>
          </form>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="container footer__inner">
        <span>Â© go2kÃ¸reskole</span>
        <span class="muted" data-i18n="footerTag">KÃ¸reskole booking</span>
      </div>
    </footer>
  </main>

  <script>
    (async () => {
      const $ = (id) => document.getElementById(id);

      async function api(path, options = {}) {
        const res = await fetch(path, { credentials: "include", ...options });
        const data = await res.json().catch(() => ({}));
        return { res, data };
      }

      const statusEl = $("loginStatus");
      const setStatus = (text, type="") => {
        if (!statusEl) return;
        statusEl.textContent = text;
        statusEl.className = `status ${type}`.trim();
      };

      // If already logged in -> route based on role
      const me = await api("/api/auth/me");
      if (me?.data?.user) {
        const role = me.data.user.role;
        window.location.href = role === "admin" ? "/admin.html" : "/index.html";
        return;
      }

      const form = $("loginForm");
      form?.addEventListener("submit", async (e) => {
        e.preventDefault();
        setStatus("");

        const email = $("loginEmail")?.value?.trim();
        const password = $("loginPassword")?.value;

        const { res, data } = await api("/api/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });

        if (!res.ok) {
          setStatus(data?.error === "INVALID_LOGIN" ? "Forkert e-mail eller kodeord." : (data?.error || "Login fejlede."), "error");
          return;
        }

        const role = data?.user?.role;
        window.location.href = role === "admin" ? "/admin.html" : "/index.html";
      });
    })();
  </script>

  <script src="./app.js"></script>
</body>
</html>
